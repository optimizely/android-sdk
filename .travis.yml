# travis ref: https://docs.travis-ci.com/user/languages/android

language: android
sudo: required
jdk: oraclejdk8

env:
  matrix:
  - EMULATOR_API=19 EMULATOR_TAG=google_apis ANDROID_ABI=x86    # API-16 build fails in travis
  - EMULATOR_API=21 EMULATOR_TAG=google_apis ANDROID_ABI=x86
  - EMULATOR_API=29 EMULATOR_TAG=google_apis ANDROID_ABI=x86
  
android:
  components:
    - tools
    - platform-tools
    - build-tools-29.0.3
    - android-29

before_install:
  - touch $HOME/.android/repositories.cfg
  # needed to install "avdmanager"
  - echo yes | sdkmanager tools
  - echo yes | sdkmanager "system-images;android-$EMULATOR_API;$EMULATOR_TAG;$ANDROID_ABI"

before_script:
  - echo $TRAVIS_BRANCH
  - echo $TRAVIS_TAG
  - echo no | avdmanager --verbose create avd --force --name "emulator-$EMULATOR_API" --package "system-images;android-$EMULATOR_API;$EMULATOR_TAG;$ANDROID_ABI" --tag "$EMULATOR_TAG"
  - emulator -avd test -no-audio -no-window &
  - scripts/android-wait-for-emulator.sh
  - adb shell input keyevent 82 &
script:
  - ./gradlew cleanAllModules
  - ./gradlew testAllModulesTravis
