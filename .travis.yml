# travis ref: https://docs.travis-ci.com/user/languages/android

language: android
sudo: required
jdk: oraclejdk8

env:
  matrix:
  - EMULATOR_API=19 ANDROID_ABI=armeabi-v7a    # API-16 build fails in travis
  - EMULATOR_API=21 ANDROID_ABI=armeabi-v7a
  - EMULATOR_API=29 ANDROID_ABI=x86
  
android:
  components:
    - tools
    - platform-tools
    - build-tools-29.0.3
    - android-29
    - sys-img-armeabi-v7a-android-19
    - sys-img-armeabi-v7a-android-21
    - sys-img-x86-android-29

before_install:
  - touch $HOME/.android/repositories.cfg
  #- yes | sdkmanager "platforms;android-$EMULATOR_API"
  #- yes | sdkmanager "system-images;android-$EMULATOR_API;default;armeabi-v7a"
  #- yes | sdkmanager "build-tools;29.0.3"

before_script:
  - echo $TRAVIS_BRANCH
  - echo $TRAVIS_TAG
  - echo no | android create avd --force -n test -t android-$EMULATOR_API --abi $ANDROID_ABI || sdkmanager --list
  - emulator -avd test -no-audio -no-window &
  - scripts/android-wait-for-emulator.sh
  - adb shell input keyevent 82 &
script:
  - ./gradlew cleanAllModules
  - ./gradlew testAllModulesTravis
